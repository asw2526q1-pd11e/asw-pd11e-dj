{% extends "base.html" %}

{% block title %}Perfil de {{ user_obj.username }}{% endblock %}

{% block content %}

<div class="position-relative mb-5">

    {% if profile.banner %}
    <img src="{{ profile.banner.url }}"
         class="w-100"
         style="height: 220px; object-fit: cover; border-radius: 10px;">
    {% endif %}

    {% if profile.avatar %}
    <img src="{{ profile.avatar.url }}"
         class="rounded-circle position-absolute"
         style="
            width: 140px;
            height: 140px;
            object-fit: cover;
            left: 20px;
            bottom: -70px;
            border: 4px solid white;">
    {% endif %}

</div>

<div style="margin-left: 20px; margin-top: 100px;">

    <h2 class="fw-bold">{{ profile.nombre|default:user_obj.username }}</h2>

    <p class="text-muted mb-2">@{{ user_obj.username }}</p>

    <p class="text-muted mb-1">
        {{ num_posts }} Posts · {{ num_comments }} Comments
    </p>

    <p class="mb-2">
        {% if profile.bio %}
        {{ profile.bio }}
        {% else %}
        <span class="text-muted">Este usuario no tiene biografía.</span>
        {% endif %}
    </p>

    <p class="text-muted" style="font-size: 0.9rem;">
        Se unió el {{ user_obj.date_joined|date:"j F Y" }}
    </p>

</div>

<div class="filter-toggle-group mt-3">
    <button class="filter-btn active" data-mode="posts">Publicaciones</button>
    <button class="filter-btn" data-mode="comments">Comentarios</button>
</div>

<div id="user-posts" class="user-posts mt-3">
    {% for post in posts %}
    <div class="card mb-2 p-2">
        <h5>{{ post.title }}</h5>
        <p>{{ post.content|truncatewords:20 }}</p>
        <small class="text-muted">{{ post.created_at|date:"j F Y, H:i" }}</small>
    </div>
    {% empty %}
    <p>Este usuario no ha publicado nada.</p>
    {% endfor %}
</div>

<div id="user-comments" class="user-comments mt-3 hidden">
    {% for comment in comments %}
    <div class="card mb-2 p-2">
        <p>{{ comment.content|truncatewords:15 }}</p>
        <small class="text-muted">En: {{ comment.post.title }}</small>
    </div>
    {% empty %}
    <p>Este usuario no ha comentado nada.</p>
    {% endfor %}
</div>

<style>
    .hidden {
        display: none;
    }

    .filter-toggle-group {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
    }

    .filter-btn {
        border: 2px solid var(--rose-400);
        background: white;
        color: var(--rose-600);
        border-radius: 50px;
        padding: 0.45rem 1.25rem;
        font-weight: 600;
        cursor: pointer;
        transition: all var(--transition-base);
    }

    .filter-btn:hover {
        background: #fff1f2;
    }

    .filter-btn.active {
        background: var(--rose-500);
        color: white;
        border-color: var(--rose-500);
        box-shadow: var(--shadow-sm);
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const buttons = document.querySelectorAll('.filter-btn');
        const posts = document.getElementById('user-posts');
        const comments = document.getElementById('user-comments');

        buttons.forEach(btn => {
            btn.addEventListener('click', function() {
                // Quitar clase active de todos
                buttons.forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                const mode = this.dataset.mode;

                if (mode === 'posts') {
                    posts.classList.remove('hidden');
                    comments.classList.add('hidden');
                } else if (mode === 'comments') {
                    posts.classList.add('hidden');
                    comments.classList.remove('hidden');
                }
            });
        });
    });
</script>


{% endblock %}
