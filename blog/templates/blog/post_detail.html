{% extends "base.html" %}
{% load static %}

{% block title %}{{ post.title }} | DailyPost{% endblock %}

{% block extra_head %}
<style>
    .post-detail-card {
      border: 3px solid #d63384;
      border-radius: 20px;
      background-color: #fff;
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
      padding: 30px;
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
      align-items: flex-start;
    }

    .post-detail-image {
      flex: 0 0 280px;
      text-align: center;
    }

    .post-detail-image img {
      width: 100%;
      height: auto;
      max-height: 250px;
      object-fit: cover;
      border-radius: 15px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .post-detail-content {
      flex: 1;
      min-width: 300px;
    }

    .post-detail-title {
      font-size: 2.2em;
      color: #d63384;
      margin-bottom: 10px;
    }

    .post-detail-meta {
      color: #777;
      font-size: 1.1em;
      margin-bottom: 20px;
    }

    .post-detail-votes {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .vote-btn {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1.8em;
      color: #666;
    }

    .vote-btn.up.active {
      color: #28a745;
    }

    .vote-btn.down.active {
      color: #dc3545;
    }

    .communities-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .community-badge {
      background: #fce4ec;
      padding: 6px 12px;
      border-radius: 20px;
      font-weight: 500;
      font-size: 0.9em;
      color: #b30059;
      text-decoration: none;
      display: flex;
      align-items: center;
      transition: all 0.2s;
    }

    .community-badge:hover {
      background: #f8bbd0;
      text-decoration: none;
    }

    .post-content {
      font-size: 1.15em;
      line-height: 1.7;
      text-align: justify;
      margin-top: 20px;
    }
</style>
{% endblock %}

{% block content %}
<div class="post-detail-card">

    {% if post.image %}
    <div class="post-detail-image">
        <img src="{{ post.image.url }}" alt="{{ post.title }}">
    </div>
    {% endif %}

    <div class="post-detail-content">

        <h1 class="post-detail-title">
            {{ post.title }}
            {% if post.url %}
            <a href="{{ post.url }}" target="_blank" title="Ver enlace relacionado" style="text-decoration:none; font-size:0.8em; margin-left:8px;">üîó</a>
            {% endif %}
        </h1>

        <p class="post-detail-meta">
            Publicado por <strong>{{ post.author }}</strong> el
            <em>{{ post.published_date|date:"d 'de' F 'de' Y, H:i" }}</em>
        </p>

        <div class="d-flex flex-wrap justify-content-between align-items-center mb-3">

            <!-- Sistema de votos -->
            <div class="post-detail-votes">
                <form action="{% url 'blog:upvote_post' post.pk %}" method="post" class="m-0">
                    {% csrf_token %}
                    <button type="submit" class="vote-btn up {% if user_vote == 1 %}active{% endif %}">‚ñ≤</button>
                </form>

                <span style="font-size: 1.5em; font-weight: bold;">{{ post.votes }}</span>

                <form action="{% url 'blog:downvote_post' post.pk %}" method="post" class="m-0">
                    {% csrf_token %}
                    <button type="submit" class="vote-btn down {% if user_vote == -1 %}active{% endif %}">‚ñº</button>
                </form>
            </div>

            <!-- Comunidades -->
            {% if post.communities.exists %}
            <div class="communities-badges">
                {% for community in post.communities.all %}
                <a href="{% url 'communities:community_site' community.pk %}" class="community-badge">
                    {% if community.avatar %}
                        <img src="{{ community.avatar.url }}" alt="{{ community.name }}">
                    {% endif %}
                    {{ community.name }}
                </a>
                {% endfor %}
            </div>
            {% endif %}
        </div>

        <div class="post-content mb-4">
            {{ post.content|linebreaks }}
        </div>

        <a href="{% url 'blog:post_list' %}" class="btn btn-rose text-white px-4 py-2" style="border-radius:10px;">
            ‚Üê Volver al listado
        </a>

    </div>
</div>

<!-- Comentarios -->
{% include "blog/comments_section.html" with post_id=post.id %}
{% endblock %}
