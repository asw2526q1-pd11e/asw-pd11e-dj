{% extends "base.html" %}

{% block title %}Lista de Posts{% endblock %}

{% block content %}
<h1 class="text-2xl font-bold mb-4">Lista de Posts</h1>

{% if posts_data %}
<div class="posts-list">
    {% for item in posts_data %}
        {% include "blog/post_card.html" with post=item.post user_vote=item.user_vote %}
    {% endfor %}
</div>
{% else %}
<p>No hay posts disponibles.</p>
{% endif %}

<p>
    <a href="{% url 'blog:post_create' %}" class="btn btn-primary">Crear un nuevo Post</a>
</p>

<script>
    document.querySelectorAll(".save-post-btn").forEach(btn => {
        btn.addEventListener("click", function() {
            const postId = this.dataset.postId;
            fetch(`/accounts/toggle-saved/${postId}/`, {
                method: "POST",
                headers: {
                    "X-CSRFToken": getCookie('csrftoken')
                }
            })
                .then(res => res.json())
                .then(data => {
                    this.textContent = data.saved ? '★' : '☆';
                });
        });
    });

    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            document.cookie.split(';').forEach(cookie => {
                const c = cookie.trim();
                if (c.startsWith(name + '=')) cookieValue = decodeURIComponent(c.substring(name.length + 1));
            });
        }
        return cookieValue;
    }
</script>

{% endblock %}
